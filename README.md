# database_PX

Pipeline and tooling for collecting IBGE datasets (CNT, PMS, PMC), pushing them to Firebase, and validating the results.

## Repository layout

- `scripts to pull data/`: ingestion scripts, shared utilities, and operational helpers.
- `scripts to visualize data/`: notebooks and tooling for exploring Firebase data exports.
- `.github/workflows/`: GitHub Actions definitions for manual CI/CD execution.
- `usage_summary.txt`: Firebase/GitHub usage snapshot generated by `usage_summary_generator.py`.
- `status_summary.txt`: workflow and Firebase dataset status generated by `summarize_status.py`.

## Prerequisites

- Python 3.11 (matches the GitHub Actions runners).
- Install dependencies: `pip install -r requirements.txt`.
- Optional: export `GITHUB_TOKEN` (classic token with `repo` scope or fine-grained equivalent) so usage summaries can query private repo metadata.

## Manual updates from any machine

All automatic schedules are disabled. Use the helper CLI to run updates locally or adjust workflow schedules:

```bash
python "scripts to pull data/update_database.py"
```

Running with no arguments opens an interactive menu. Common one-liners:

| Purpose | Example command |
| --- | --- |
| List categories | `python "scripts to pull data/update_database.py" list` |
| List tables in a category | `python "scripts to pull data/update_database.py" list-tables cnt` |
| Run entire category | `python "scripts to pull data/update_database.py" run pms` |
| Run specific tables | `python "scripts to pull data/update_database.py" run pmc --table 8880 --table 8881` |
| Skip verification | add `--no-verify` |
| Add/update workflow cron | `python "scripts to pull data/update_database.py" schedule cnt --cron "0 12 1-4 3,6,9,12 *"` |
| Remove workflow cron | `python "scripts to pull data/update_database.py" schedule cnt` |

The CLI invokes the same ingestion code that the workflows use (`run_all_tables.py`, `run_all_pms.py`, `run_all_pmc.py`, or individual table scripts). After successful runs, Firebase structure validators (`verify_structure.py`, `verify_pms_structure.py`) confirm uploads.

## GitHub Actions workflows

Workflows are manual-only and appear in the Actions tab:

- `Update IBGE CNT Data`
- `Update IBGE PMS Data`
- `Update IBGE PMC Data`
- `Test Single IBGE Table`

Use **Run workflow** in GitHub whenever you want the hosted runner to execute the update sequence. To reintroduce automatic cadences, either edit the YAML or use the CLI `schedule` command.

## Generating reports

- Usage summary: `python "scripts to pull data/usage_summary_generator.py"`
- Status summary: `python "scripts to pull data/summarize_status.py"`

These scripts refresh `usage_summary.txt` and `status_summary.txt`; re-run them after ingesting new data or changing schedules.

## Firebase maintenance helpers

Key utilities in `scripts to pull data/`:

- `cleanup_root_folders.py` / `cleanup_old_structure.py`: remove deprecated nodes.
- `verify_structure.py` / `verify_pms_structure.py`: validate Firebase documents.
- `reset_firebase_structure.py`: rebuild Firebase scaffolding (use with caution).
- `summarize_status.py`, `usage_summary_generator.py`: regenerate operational dashboards.

Refer to each scriptâ€™s docstring for extra usage notes.
