# database_PX

Pipeline and tooling for collecting IBGE datasets (CNT, PMS, PMC, PNADCT, PNADCM, IPP), pushing them to Firebase, and validating the results.

## üìã Roadmap

Para ver o roadmap completo de desenvolvimento, consulte:
- **[ROADMAP.md](ROADMAP.md)** - Roadmap detalhado por fases
- **[ROADMAP_SUMMARY.md](ROADMAP_SUMMARY.md)** - Resumo executivo

## üìä Status Atual

- ‚úÖ **123,574 s√©ries catalogadas** em formato flat otimizado
- ‚úÖ **9/10 datasets IBGE completos** (99%+ de cobertura)
- ‚ö†Ô∏è **LSPA:** 84.5% completo (2,587 s√©ries Safra 2024/2025 bloqueadas pelo IBGE)
- ‚ö†Ô∏è **PNADCT:** 99.99% completo (5 s√©ries com erros de conex√£o)
- üöß **RTN (Tesouro Transparente):** Em desenvolvimento

## Repository layout

- `scripts to pull data/`: ingestion scripts, shared utilities, and operational helpers.
- `scripts to visualize data/`: notebooks and tooling for exploring Firebase data exports.
- `.github/workflows/`: GitHub Actions definitions for manual CI/CD execution.
- `usage_summary.txt`: Firebase/GitHub usage snapshot generated by `usage_summary_generator.py`.
- `status_summary.txt`: workflow and Firebase dataset status generated by `summarize_status.py`.

## Prerequisites

- Python 3.11 (matches the GitHub Actions runners).
- Install dependencies: `pip install -r requirements.txt`.
- Optional: export `GITHUB_TOKEN` (classic token with `repo` scope or fine-grained equivalent) so usage summaries can query private repo metadata.

## Manual updates from any machine

All automatic schedules are disabled. Use the helper CLI to run updates locally or adjust workflow schedules:

```bash
python "scripts to pull data/update_database.py"
```

Running with no arguments opens an interactive menu. Common one-liners:

| Purpose | Example command |
| --- | --- |
| List categories | `python "scripts to pull data/update_database.py" list` |
| List tables in a category | `python "scripts to pull data/update_database.py" list-tables cnt` |
| Run entire category | `python "scripts to pull data/update_database.py" run pms` |
| Run specific tables | `python "scripts to pull data/update_database.py" run pmc --table 8880 --table 8881` |
| Run PNADCT unemployment only | `python "scripts to pull data/update_database.py" run pnadct --table 6468` |
| Run all PNADCM tables | `python "scripts to pull data/update_database.py" run pnadcm` |
| Run all IPP tables | `python "scripts to pull data/update_database.py" run ipp` |
| Skip verification | add `--no-verify` |
| Add/update workflow cron | `python "scripts to pull data/update_database.py" schedule cnt --cron "0 12 1-4 3,6,9,12 *"` |
| Remove workflow cron | `python "scripts to pull data/update_database.py" schedule cnt` |

The CLI invokes the same ingestion code that the workflows use (`run_all_tables.py`, `run_all_pms.py`, `run_all_pmc.py`, or individual table scripts). After successful runs, Firebase structure validators (`verify_structure.py`, `verify_pms_structure.py`) confirm uploads.

## GitHub Actions workflows

Workflows are manual-only and appear in the Actions tab:

- `Update IBGE CNT Data`
- `Update IBGE PMS Data`
- `Update IBGE PMC Data`
- `Update IBGE PNADCT Data`
- `Update IBGE PNADCM Data`
- `Update IBGE IPP Data`
- `Test Single IBGE Table`

Use **Run workflow** in GitHub whenever you want the hosted runner to execute the update sequence. To reintroduce automatic cadences, either edit the YAML or use the CLI `schedule` command.

## Generating reports

- Usage summary: `python "scripts to pull data/usage_summary_generator.py"`
- Status summary: `python "scripts to pull data/summarize_status.py"`

These scripts refresh `usage_summary.txt` and `status_summary.txt`; re-run them after ingesting new data or changing schedules.

## Firebase maintenance helpers

Key utilities in `scripts to pull data/`:

- `cleanup_root_folders.py` / `cleanup_old_structure.py`: remove deprecated nodes.
- `verify_structure.py` / `verify_pms_structure.py`: validate Firebase documents.
- `reset_firebase_structure.py`: rebuild Firebase scaffolding (use with caution).
- `summarize_status.py`, `usage_summary_generator.py`: regenerate operational dashboards.

Refer to each script's docstring for extra usage notes.

## üìö Documenta√ß√£o Adicional

- **[CHANGELOG.md](CHANGELOG.md)** - Hist√≥rico de mudan√ßas
- **[ROADMAP.md](ROADMAP.md)** - Roadmap de desenvolvimento
- **[ROADMAP_SUMMARY.md](ROADMAP_SUMMARY.md)** - Resumo executivo do roadmap

## ü§ù Contribuindo

Veja o [ROADMAP.md](ROADMAP.md) para entender as prioridades atuais e como contribuir.

Para reportar bugs ou sugerir features, use os templates de issues do GitHub.
